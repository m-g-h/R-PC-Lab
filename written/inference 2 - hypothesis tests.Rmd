---
title: "Inference 2 - Hypothesis Tests"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_float: no
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Introduction

This section covers a fundamental part of inference: hypothesis testing. Tests of hypotheses are frequently applied in econometrics, e.g. t-tests for OLS parameters or in tests for heteroscedasticity.

We use hypothesis testing, because we don't much about our populations, just from a sample.

**We actually don't know**:

- The population mean $\mu_X$ (our parameter of interest)
- The population variance $\sigma^2_X$ and standard deviation $\sigma_X$
- The true distribution of the population $X \sim ?(?)$

In this scenario (which is the realistic scenario) we do the following:

**Assume the population distribution and a value for our parameter of interest. Then estimate the unknown parameters from a sample and test if our assumptions are reasonable.**

This procedure is called hypothesis testing

Assume that the distribution of the population is normal (e.g. because it is reasonably from theory)#

1. Formulate a hypothesis about our population mean (e.g. $H_0:\mu_X = 1000$)
2. Estimate the mean with the arithmetic mean $\bar{X}$
3. Estimate the variance and derive the sample standard deviation $S_X$
4. Standardise $\bar{X}$ using our estimated $S_X$ and the assumed $\mu_X$
5. Calculate the probability that our observed $\bar{X}$ is from the population, given a specific level of certainty (e.g. $95 \%$)


## Simulated Population

We take again our sample from a simulated population of ZU student income:

```{r fig.height=4, fig.width=9, message=FALSE, warning=FALSE}
library(ggplot2)
library(tidyverse)
set.seed(11) # seed for reproducibility

n <- 1200
inc_2 <- rnorm(n, mean = 1000, sd = 200)

ggplot() +
geom_histogram(aes(x = inc_2,
y = ..density..),binwidth = 60,alpha = 0.8) +
geom_density(aes(x = inc_2,
y = ..density..),col = "red",size = 2,alpha = 0.8) +
labs(title = "Income of ZU Students") +
theme_minimal()

```

## Sample

We draw a random sample with size `50` from our population:

```{r}
set.seed(24)
sample_n <- 50
sample_2 <- sample(x = inc_2, size = sample_n, replace = F)
```



```{r fig.height=4, fig.width=9}
ggplot() +
geom_histogram(aes(x = sample_2,
y = ..density..),binwidth = 50,alpha = 0.8) +
labs(title = "SAMPLE Histogram Income ZU Students") +
theme_minimal()
```

# Hypothesis Testing Procedure

Given the assumption that our population is distributed normally we:

**1. Formulate the Null-Hypothesis that mean student income is less then $940 €$:**
$$ H_0 : \mu_{inc} < 940  $$
Which leaves us with the alternative Hypothesis that the mean income is more or equal to $940€$:
$$ H_1: \mu_{inc} \geq 940 $$
```{r}
mu_inc = 940
mu_inc
```

**2. Estimate the mean with the sample mean $\bar{X}$ :**
```{r}
inc_bar <- mean(sample_2)
inc_bar
```

**3. Estimate the sampling variance $S^2$ and derive the sampling standard** deviation $S$ :
```{r}
var(sample_2)
```
```{r}
S_inc <- sd(sample_2)
S_inc
```

At this state we would expect our sample mean to be distributed like this:

```{r fig.height=4, fig.width=9}
ggplot(data =  data.frame(X_bar = 850:1030), aes(x=X_bar)) +
  stat_function(fun = dnorm, args = list(mean = mu_inc, sd = S_inc/sqrt(sample_n)), size = 2) +
  geom_vline(xintercept = inc_bar, color = "red", size = 1.5) +
  geom_vline(xintercept = mu_inc, color = "green", size = 1.5) +
  labs(title = "Assumed PDF of our sample mean under H0") +
  theme_minimal()
```


**4. Standardise $\bar{X}$ so we can easily calculate probabilities**

```{r}
Z_inc_bar <- (inc_bar - 940) / (S_inc / sqrt(sample_n))
Z_inc_bar
```

```{r fig.height=4, fig.width=9}
ggplot(data =  data.frame(Z_inc_bar = -4:4), aes(x=Z_inc_bar)) +
  stat_function(fun = dnorm, args = list(mean = 0, sd = 1), size = 2) +
  geom_vline(xintercept = Z_inc_bar, color = "red", size = 1.5) +
  geom_vline(xintercept = 0, color = "green", size = 1.5) +
  labs(title = "Assumed PDF of our standardised sample mean under H0") +
  theme_minimal()
```

**5. Calculate probability of $\bar{X}$ occuring at 5% significance level:**

Look up $z-value$ for $1-5\% = 95\%$, e.g. in this [table]{http://www.z-table.com/}.
$$ z_{1-\alpha} = 1.65 $$

```{r fig.height=4, fig.width=9}
ggplot(data =  data.frame(Z_inc_bar = -4:4), aes(x=Z_inc_bar)) +
  stat_function(fun = dnorm, args = list(mean = 0, sd = 1), size = 2) +
    stat_function(fun = dnorm, xlim = c(-4,1.65), geom = "area", fill = "grey", alpha=0.5) +
  stat_function(fun = dnorm, xlim = c(1.65,4), geom = "area", fill = "black", alpha=0.5) +
  geom_vline(xintercept = Z_inc_bar, color = "red", size = 1.5) +
  geom_vline(xintercept = 0, color = "green", size = 1.5) +
  labs(title = "Assumed PDF of our standardised sample mean under H0") +
  theme_minimal()
```
